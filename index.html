<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Ghost of Tabor – Random Kit Generator</title>
<style>
    body { font-family: Arial; padding: 20px; }
    h2 { margin-bottom: 4px; }
    .category-box { border: 1px solid #ccc; padding: 10px; margin-bottom: 20px; border-radius: 8px; }
    .item { margin-top: 10px; }
    img { max-width: 300px; margin-top: 8px; border: 1px solid #888; border-radius: 6px; }
    button { padding: 10px 20px; margin: 15px 0; font-size: 16px; }
</style>
</head>
<body>

<h1>Ghost of Tabor – Random Kit Generator</h1>
<p>Select subsections to include. Each click will generate:</p>

<ul>
  <li>1 Backpack</li>
  <li>1 Chestrig</li>
  <li>1 Helmat</li>
  <li>1 Weapon</li>
</ul>

<h2>Subsection Toggles</h2>
<div id="toggles">Loading subsections...</div>

<button id="generateBtn">Generate Loadout</button>

<h2>Results</h2>
<div id="results"></div>

<script>
function chooseWeightedSubfolder(folders) {
    const weights = {
        "Buyable": 5,
        "DLCs": 4,
        "FoundInRaid": 1,
        "BossDrops": 1,
        "WipeRewards": 1
    };

    let pool = [];

    folders.forEach(folder => {
        const w = weights[folder] || 1;
        for (let i = 0; i < w; i++) {
            pool.push(folder);
        }
    });

    return pool[Math.floor(Math.random() * pool.length)];
}
    // CONFIG ------------------------------------------------------------
const USER = "ke3g4n";
const REPO = "GhostofTabor-Randomkit";
const BRANCH = "main";
const RAW = `https://raw.githubusercontent.com/${USER}/${REPO}/${BRANCH}/images`;

const CATEGORIES = ["Backpacks", "Chestrigs", "Helmats", "Weapons"];

// UI references
const togglesDiv = document.getElementById("toggles");
const resultsDiv = document.getElementById("results");

// Fetch folder contents from GitHub API
async function listDir(path) {
    const url = `https://api.github.com/repos/${USER}/${REPO}/contents/${path}?ref=${BRANCH}`;
    const res = await fetch(url);
    if (!res.ok) return [];
    return await res.json();
}

// Auto-detect existing subsections and build toggles
async function loadSubsections() {
    togglesDiv.innerHTML = "";
    window.subsections = {};

    for (const cat of CATEGORIES) {
        const catPath = `images/${cat}`;
        const subs = await listDir(catPath);

        const validSubs = subs.filter(s => s.type === "dir").map(s => s.name);
        window.subsections[cat] = validSubs;

        const div = document.createElement("div");
        div.className = "category-box";
        div.innerHTML = `<h3>${cat}</h3>`;

        validSubs.forEach(sub => {
            const id = `${cat}-${sub}`;
            div.innerHTML += `
                <label>
                    <input type="checkbox" id="${id}" checked>
                    ${sub}
                </label><br>
            `;
        });

        togglesDiv.appendChild(div);
    }
}

// Pick random from array
function pick(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
}

// Generate one item per category
async function generate() {
    resultsDiv.innerHTML = "";

    for (const cat of CATEGORIES) {
        const subs = window.subsections[cat];
        const enabledSubs = subs.filter(sub => {
            const id = `${cat}-${sub}`;
            const box = document.getElementById(id);
            return box && box.checked;
        });

        if (enabledSubs.length === 0) {
            resultsDiv.innerHTML += `<p><b>${cat}:</b> No subsections enabled.</p>`;
            continue;
        }

        const chosenSub = chooseWeightedSubfolder(enabledSubs);

        const files = await listDir(`images/${cat}/${chosenSub}`);
        const realFiles = files.filter(f => f.type === "file");

        if (realFiles.length === 0) {
            resultsDiv.innerHTML += `<p><b>${cat}:</b> No images found in ${chosenSub}.</p>`;
            continue;
        }

        const file = pick(realFiles);
        const url = `${RAW}/${cat}/${chosenSub}/${file.name}`;

        resultsDiv.innerHTML += `
            <div class="item">
                <h3>${cat}</h3>
                <p>Subsection: <b>${chosenSub}</b><br>File: ${file.name}</p>
                <img src="${url}">
            </div>
        `;
    }
}

document.getElementById("generateBtn").onclick = generate;

// Init
loadSubsections();
</script>

</body>
</html>
