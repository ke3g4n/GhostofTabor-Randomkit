<!DOCTYPE html>
<html>
<head>
    <title>Ghosts of Tabor Kit Generator</title>
    <style>
        body { font-family: Arial; background: #111; color: white; text-align: center; }
        img { max-width: 280px; margin: 15px; border-radius: 10px; }
        .category { margin-bottom: 25px; }
    </style>
</head>
<body>

<h1>Ghosts of Tabor Random Kit Generator</h1>

<!-- Checkboxes for filters -->
<h3>Include sections:</h3>
<label><input type="checkbox" id="buyable" checked> Buyable</label>
<label><input type="checkbox" id="bossDrops" checked> Boss Drops</label>
<label><input type="checkbox" id="foundInRaid" checked> Found In Raid</label>
<label><input type="checkbox" id="dlc" checked> DLC</label>
<label><input type="checkbox" id="wipeReward" checked> Wipe Rewards</label>

<br><br>
<button onclick="generate()">Generate Kit</button>

<div id="results"></div>

<script>
const base = "images/";

const paths = {
    Backpacks: {
        Buyable: "Backpacks/Buyable/"
    },
    Chestrigs: {
        Boss: "Chestrigs/Boss/",
        Buyable: "Chestrigs/Buyable/",
        FoundInRaid: "Chestrigs/FoundInRaid/"
    },
    Helmets: {
        BossDrops: "Helmets/BossDrops/",
        Buyable: "Helmets/Buyable/",
        DLCs: "Helmets/DLCs/",
        WipeReward: "Helmets/WipeReward/"
    },
    Weapons: {
        BossDrops: "Weapons/BossDrops/",
        Buyable: "Weapons/Buyable/",
        DLC: "Weapons/DLC/",
        FoundInRaid: "Weapons/FoundInRaid/",
        WipeRewards: "Weapons/WipeRewards/"
    }
};

function getRandom(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
}

async function getImagesFrom(folder) {
    const apiURL = `https://api.github.com/repos/ke3g4n/GhostofTabor-Randomkit/contents/images/${folder}`;
    const res = await fetch(apiURL);
    const data = await res.json();
    return data.filter(f => f.name.endsWith(".webp") || f.name.endsWith(".png") || f.name.endsWith(".jpg"))
        .map(f => f.path);
}

async function getRandomFromCategory(category, filters) {
    let folders = paths[category];
    let selectedFolders = [];

    for (let s in folders) {
        if (filters.includes(s.toLowerCase())) {
            selectedFolders.push(folders[s]);
        }
    }

    if (selectedFolders.length === 0) return null;

    let randomFolder = getRandom(selectedFolders);
    let images = await getImagesFrom(randomFolder);

    if (images.length === 0) return null;

    return getRandom(images);
}

async function generate() {
    let filters = [];
    if (buyable.checked) filters.push("buyable");
    if (bossDrops.checked) filters.push("bossdrops");
    if (foundInRaid.checked) filters.push("foundinraid");
    if (dlc.checked) filters.push("dlc");
    if (wipeReward.checked) filters.push("wipereward", "wiperewards");

    const categories = ["Backpacks", "Chestrigs", "Helmets", "Weapons"];

    document.getElementById("results").innerHTML = "<h3>Generating...</h3>";

    let html = "";

    for (let c of categories) {
        let img = await getRandomFromCategory(c, filters);
        if (img) {
            html += `<div class='category'><h2>${c}</h2><img src="https://raw.githubusercontent.com/ke3g4n/GhostofTabor-Randomkit/main/${img}"></div>`;
        } else {
            html += `<div class='category'><h2>${c}</h2><p>No images found</p></div>`;
        }
    }

    document.getElementById("results").innerHTML = html;
}

</script>

</body>
</html>
