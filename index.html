import os
import random
import json

# ---------------------------------------------------
# CONFIGURATION: Turn sub-sections on/off here
# ---------------------------------------------------
# Example structure â€“ set True to include, False to exclude

CONFIG = {
    "Backpacks": {
        "Buyable": True,
        "FoundInRaid": True,
        "BossDrops": False,
        "DLCs": True,
        "WipeReward": False
    },
    "Chestrigs": {
        "Buyable": True,
        "FoundInRaid": True,
        "Boss": True,
        "WipeReward": False
    },
    "Helmets": {
        "Buyable": True,
        "FoundInRaid": True,
        "BossDrops": False,
        "DLCs": True,
        "WipeReward": False
    },
    "Weapons": {
        "Buyable": True,
        "FoundInRaid": True,
        "BossDrops": False,
        "DLC": True,
        "WipeRewards": True
    }
}

# ---------------------------------------------------
# MAIN FUNCTION
# ---------------------------------------------------

def pick_random_item(base_dir="images"):
    """
    Randomly picks a category, then a sub-section (if enabled),
    then a random file from that folder.
    """

    # Filter enabled categories
    enabled_categories = [cat for cat in CONFIG.keys()]

    if not enabled_categories:
        raise Exception("No categories enabled in CONFIG!")

    # Choose a category at random
    chosen_category = random.choice(enabled_categories)

    # Filter enabled sub-sections
    enabled_subs = [sub for sub, enabled in CONFIG[chosen_category].items() if enabled]

    if not enabled_subs:
        raise Exception(f"No enabled subsections for {chosen_category}")

    chosen_sub = random.choice(enabled_subs)

    # Build path to the folder
    folder_path = os.path.join(base_dir, chosen_category, chosen_sub)

    if not os.path.exists(folder_path):
        raise FileNotFoundError(f"Folder does not exist: {folder_path}")

    # Get list of files inside
    files = [f for f in os.listdir(folder_path) if os.path.isfile(os.path.join(folder_path, f))]

    if not files:
        raise Exception(f"No files found in: {folder_path}")

    chosen_file = random.choice(files)

    return {
        "category": chosen_category,
        "sub_section": chosen_sub,
        "file": chosen_file,
        "full_path": os.path.join(folder_path, chosen_file)
    }

# ---------------------------------------------------
# Example usage
# ---------------------------------------------------
if __name__ == "__main__":
    result = pick_random_item()
    print(json.dumps(result, indent=4))
